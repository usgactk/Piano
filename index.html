<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Piano - Infinite Colors</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-color: #a29bfe;
            --accent-color: #6a11cb;
            --secondary-color: #2575fc;
        }

        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 0; background: #05050a;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; font-family: 'Montserrat', sans-serif;
            overflow: hidden; user-select: none; touch-action: none;
        }

        #game-container {
            width: 360px; height: 600px; background: #0f0f1a;
            position: relative; overflow: hidden; border-radius: 20px;
            box-shadow: 0 0 40px var(--neon-color); border: 2px solid #2a2a4a;
            transition: box-shadow 0.5s ease;
        }

        #top-stats {
            position: absolute; top: 0; width: 100%; height: 60px;
            background: rgba(255, 255, 255, 0.05);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 20; border-bottom: 1px solid var(--neon-color);
            backdrop-filter: blur(5px);
        }

        .stat-box { text-align: center; color: #fff; }
        .stat-label { font-size: 9px; color: var(--neon-color); letter-spacing: 1px; margin-bottom: 2px; }
        .stat-value { font-size: 16px; text-shadow: 0 0 10px var(--neon-color); }

        .line { position: absolute; top: 0; bottom: 0; width: 1px; background: var(--neon-color); opacity: 0.2; z-index: 1; transition: background 0.5s; }

        .tile {
            position: absolute; width: 90px; height: 150px;
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--secondary-color) 100%);
            border-radius: 8px; z-index: 2; cursor: pointer;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            transition: background 0.5s;
        }
        
        .tile.active { background: #fff !important; box-shadow: 0 0 30px #fff, 0 0 50px var(--neon-color); transform: scale(0.95); }

        #main-score {
            position: absolute; top: 80px; width: 100%; text-align: center;
            font-size: 60px; color: #fff; text-shadow: 0 0 15px var(--neon-color);
            z-index: 10; pointer-events: none; opacity: 0.6;
        }

        .particle {
            position: absolute; width: 6px; height: 6px; border-radius: 50%;
            pointer-events: none; z-index: 5;
        }

        .overlay {
            position: absolute; inset: 0; background: rgba(5, 5, 15, 0.95);
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; z-index: 100; color: #fff; text-align: center;
        }

        button {
            padding: 16px 40px; font-size: 18px; font-weight: bold;
            background: linear-gradient(90deg, var(--accent-color) 0%, var(--secondary-color) 100%);
            border: none; color: #fff; border-radius: 50px; cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            transition: 0.3s; font-family: 'Montserrat', sans-serif;
        }

        #game-over-screen { display: none; z-index: 200; }

        #lvl-up-toast {
            position: absolute; width: 100%; top: 40%; text-align: center;
            color: #fff; font-size: 40px; font-weight: bold;
            text-shadow: 0 0 20px var(--neon-color); pointer-events: none;
            z-index: 50; opacity: 0;
        }

        @keyframes floatUp {
            0% { transform: translateY(20px); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-40px); opacity: 0; }
        }
        .show-toast { animation: floatUp 1.2s forwards; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="top-stats">
            <div class="stat-box"><div class="stat-label">REKOR</div><div id="high-score" class="stat-value">0</div></div>
            <div class="stat-box"><div class="stat-label">SEVİYE</div><div id="level-val" class="stat-value">1</div></div>
            <div class="stat-box"><div class="stat-label">SÜRE</div><div id="timer-val" class="stat-value">0s</div></div>
        </div>

        <div id="main-score">0</div>
        <div id="lvl-up-toast">SEVİYE 2</div>

        <div class="line" style="left: 90px;"></div>
        <div class="line" style="left: 180px;"></div>
        <div class="line" style="left: 270px;"></div>

        <div id="start-screen" class="overlay">
            <h1 style="color: #fff; margin-bottom: 20px;">NEON PIANO</h1>
            <button onclick="startGame()">OYUNA BAŞLA</button>
        </div>

        <div id="game-over-screen" class="overlay">
            <h2 style="color: #ff4757;">OYUN BİTTİ</h2>
            <div id="final-score" style="font-size: 50px; margin: 10px 0;">0</div>
            <button onclick="restartGame()">TEKRAR DENE</button>
        </div>
    </div>

    <script>
        const container = document.getElementById('game-container');
        const scoreDisplay = document.getElementById('main-score');
        const levelVal = document.getElementById('level-val');
        const timerVal = document.getElementById('timer-val');
        const highScoreVal = document.getElementById('high-score');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const toast = document.getElementById('lvl-up-toast');

        // Sabit ilk 6 tema
        const baseThemes = [
            { neon: '#a29bfe', accent: '#6a11cb', secondary: '#2575fc' },
            { neon: '#00d2ff', accent: '#3a7bd5', secondary: '#00d2ff' },
            { neon: '#55efc4', accent: '#00b894', secondary: '#55efc4' },
            { neon: '#ffeaa7', accent: '#fdcb6e', secondary: '#e17055' },
            { neon: '#ff7675', accent: '#d63031', secondary: '#ff7675' },
            { neon: '#fd79ae', accent: '#e84393', secondary: '#fd79ae' }
        ];

        let audioCtx;
        const melody = [329.63, 293.66, 261.63, 293.66, 329.63, 329.63, 329.63, 293.66, 293.66, 293.66, 329.63, 392.00, 392.00, 329.63, 293.66, 261.63, 293.66, 329.63, 329.63, 329.63, 329.63, 293.66, 293.66, 329.63, 293.66, 261.63].map(f => f * 2);
        
        let score = 0, level = 1, speed = 5.5, noteIdx = 0;
        let gameActive = false, activeTiles = [], startTime = 0, timerInterval;

        highScoreVal.innerText = localStorage.getItem('neonPianoHighScore') || 0;

        function updateTheme() {
            let theme;
            if (level <= baseThemes.length) {
                // İlk 6 seviye için senin listeni kullan
                theme = baseThemes[level - 1];
            } else {
                // 7. seviye ve sonrası için otomatik renk üret
                // level * 40 her seviyede renk çemberinde 40 derece kaydırır
                const hue = (level * 40) % 360; 
                theme = {
                    neon: `hsl(${hue}, 80%, 75%)`,
                    accent: `hsl(${(hue + 20) % 360}, 80%, 45%)`,
                    secondary: `hsl(${(hue - 20) % 360}, 80%, 60%)`
                };
            }

            document.documentElement.style.setProperty('--neon-color', theme.neon);
            document.documentElement.style.setProperty('--accent-color', theme.accent);
            document.documentElement.style.setProperty('--secondary-color', theme.secondary);
        }

        function createParticles(x, y) {
            const currentNeon = getComputedStyle(document.documentElement).getPropertyValue('--neon-color');
            for (let i = 0; i < 10; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.backgroundColor = currentNeon;
                p.style.boxShadow = `0 0 10px ${currentNeon}`;
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                container.appendChild(p);

                const angle = Math.random() * Math.PI * 2;
                const dist = Math.random() * 50 + 20;
                const tx = Math.cos(angle) * dist;
                const ty = Math.sin(angle) * dist;

                p.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
                ], { duration: 600, easing: 'cubic-bezier(0, .9, .57, 1)' }).onfinish = () => p.remove();
            }
        }

        function playNote(freq) {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.4);
        }

        function spawnTile() {
            if (!gameActive) return;
            const tile = document.createElement('div');
            tile.className = 'tile';
            const col = Math.floor(Math.random()*4);
            tile.style.left = (col * 90) + 'px';
            tile.style.top = '-150px';
            container.appendChild(tile);
            activeTiles.push(tile);

            const move = () => {
                if (!gameActive) { tile.remove(); return; }
                let top = parseFloat(tile.style.top);
                tile.style.top = (top + speed) + 'px';

                if (top > 600) {
                    if (activeTiles.includes(tile)) endGame();
                    tile.remove();
                } else requestAnimationFrame(move);
            };
            requestAnimationFrame(move);

            const handlePress = (e) => {
                e.preventDefault();
                if (!gameActive || tile !== activeTiles[0]) return;
                
                activeTiles.shift();
                playNote(melody[noteIdx % melody.length]);
                createParticles(parseInt(tile.style.left) + 45, parseInt(tile.style.top) + 75);
                
                noteIdx++; score++;
                scoreDisplay.innerText = score;
                tile.classList.add('active');

                if (score > 0 && score % 20 === 0) updateDifficulty();
                setTimeout(() => tile.remove(), 100);
            };
            tile.onmousedown = handlePress; tile.ontouchstart = handlePress;
        }

        function updateDifficulty() {
            level++;
            // Senin hız tablon
            if (level === 2) speed = 6.0;
            else if (level === 3) speed = 7.0;
            else if (level === 4) speed = 8.0;
            else speed += 0.5;

            levelVal.innerText = level;
            updateTheme();
            
            toast.innerText = "SEVİYE " + level;
            toast.classList.remove('show-toast');
            void toast.offsetWidth; 
            toast.classList.add('show-toast');
        }

        function startGame() {
            startScreen.style.display = 'none';
            gameActive = true;
            updateTheme();
            startTime = Date.now();
            timerInterval = setInterval(() => {
                if (gameActive) timerVal.innerText = Math.floor((Date.now() - startTime) / 1000) + "s";
            }, 1000);
            loop();
        }

        function restartGame() {
            score = 0; level = 1; speed = 5.5; noteIdx = 0;
            activeTiles = [];
            scoreDisplay.innerText = "0";
            levelVal.innerText = "1";
            timerVal.innerText = "0s";
            gameOverScreen.style.display = 'none';
            startGame();
        }

        function loop() {
            if (!gameActive) return;
            spawnTile();
            setTimeout(loop, Math.max(150, 850 - (speed * 50)));
        }

        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            if (score > (localStorage.getItem('neonPianoHighScore') || 0)) {
                localStorage.setItem('neonPianoHighScore', score);
                highScoreVal.innerText = score;
            }
            document.getElementById('final-score').innerText = score;
            gameOverScreen.style.display = 'flex';
            document.querySelectorAll('.tile').forEach(t => t.remove());
        }
    </script>
</body>
</html>
